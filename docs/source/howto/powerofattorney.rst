Работа с машиночитаемой доверенностью
=====================================

.. contents:: :local:

Поправки в `Федеральный закон от 06.04.2011 № 63-ФЗ <https://normativ.kontur.ru/document?moduleId=1&documentId=416095>`__ вступают в силу в 2022 году. Суть изменений в том, что сотрудники компании будут использовать сертификаты электронной подписи физлица, в которых указаны только их личные данные без указания принадлежности к организации.

Однако подписи физлица при обмене документами с контрагентами и государственными органами недостаточно, чтобы вести юридически значимый документооборот. Документы должен подписывать руководитель или его уполномоченное лицо. Для подтверждения полномочий сотрудника и его принадлежности к компании нужно выпустить машиночитаемую доверенность (МЧД).

**Машиночитаемая (электронная) доверенность** — это электронная доверенность руководителя организации, которая передает полномочия сотруднику при подписании документов. Таким работником в компании может быть бухгалтер, секретарь или менеджер по закупкам — человек, которому нужно ставить подписи от лица организации. Доверенность не нужно заверять у нотариуса. Достаточно, чтобы руководитель подписал ее своей квалифицированной электронной подписью (КЭП).

.. note::

	На время переходного периода, пока МЧД не явзяется обязательным требованием, использовать МЧД с сертификатом физлица не обязтельно.
 

Как работать с МЧД
------------------

Чтобы использовать МЧД в Диадоке, ее нужно зарегистрировать и привязать к сотруднику.
К каждому сотруднику можно привязать несколько МЧД, среди которых можно выбрать доверенность по умолчанию.


Регистрация МЧД
~~~~~~~~~~~~~~~

Если у вас есть МЧД и вы хотите использовать ее для работы в Диадоке, ее нужно зарегистрировать. Сделать это можно двумя способами:

- используя регистрационный номер МЧД и ИНН доверителя,
- используя файл МЧД с подписью.

Для регистрации МЧД вызовите метод :doc:`../http/RegisterPowerOfAttorney`, который вернет идентификатор задачи ``taskId``. По этому идентификатору с помощью метода :doc:`../http/RegisterPowerOfAttorneyResult` можно узнать результат регистрации.

Зарегистрированную МЧД нужно привязать к сотруднику, чтобы использовать ее для выполнения операций в Диадоке.


Работа с МЧД сотрудника
~~~~~~~~~~~~~~~~~~~~~~~		

Чтобы сотрудник мог использовать МЧД, она должна быть привязана к этому сотруднику. К каждому сотруднику может быть привязано несколько МЧД. Любую из них можно использовать как доверенность по умолчанию. Пользователь может в любой момент может сделать доверенностю по умолчанию другую МЧД или убрать довеернность по умолчанию совсем. Любую МЧД, уже привязанную к сотруднику, можно отвязать.

Работать с МЧД сотрудника можно с помощью методов:

- метод :doc:`../http/AddEmployeePowerOfAttorney` используется для привязки МЧД к сотруднику.
- метод :doc:`../http/DeleteEmployeePowerOfAttorney` используется для отвязки МЧД от сотрудника.
- метод :doc:`../http/UpdateEmployeePowerOfAttorney` используется, чтобы установить сотруднику доверенность по умолчанию или снять с доверенности такой признак.
- метод :doc:`../http/GetEmployeePowersOfAttorney` используется для получения списка всех МЧД, привязанных к сотруднику.

		
Получение и проверка МЧД
~~~~~~~~~~~~~~~~~~~~~~~~

Чтобы получить информацию о МЧД, отправленной с документом, используйте метод :doc:`../http/GetPowerOfAttorneyInfo`.

Для предварительной проверки МЧД используйте метод :doc:`../http/PrevalidatePowerOfAttorney`.


Как отправить документ с МЧД
----------------------------

Чтобы отправить документ с МЧД:

1. Сформируйте документ, ответный титул, технологический документ или подпись.
2. При использовании сертификата физлица выберите МЧД:

 - выберите МЧД из списка доверенностей, привязанных к сотруднику,
 - используйте МЧД по умолчанию, если она была установлена.
 
 На время переходного периода МЧД с сертификатом физлица можно не указывать.

3. Вызовите метод :doc:`../http/PostMessage`, :doc:`../http/PostMessagePatch` или :doc:`../http/SendDraft`, указав в теле запроса регистрационный номер МЧД и ИНН доверителя или признак «использовать МЧД по умолчанию». Эти методы принимают на вход структуры :doc:`../proto/SignedContent`, :doc:`../proto/DocumentSignature` и :doc:`../proto/DocumentSenderSignature`, которые хранят информацию о МЧД внутри структуры :doc:`../proto/PowerOfAttorneyToPost`.

 
Как получить МЧД
----------------

Получение МЧД в сообщении
~~~~~~~~~~~~~~~~~~~~~~~~~

Методы :doc:`../http/GetMessage`, :doc:`../http/GetNewEvents`, :doc:`../http/GetLastEvent` и :doc:`../http/GetEvent` возвращают информацию о МЧД и ее статусе внутри структуры :doc:`../proto/PowerOfAttorneyInfo`.

Получение МЧД в docflow
~~~~~~~~~~~~~~~~~~~~~~~

Методы :doc:`V3/GetDocflowEvents <../http/GetDocflowEvents_V3>`, :doc:`V3/GetDocflows <../http/GetDocflows_V3>`, :doc:`V3/GetDocflowsByPacketId <../http/GetDocflowsByPacketId_V3>`, :doc:`V3/SearchDocflows <../http/SearchDocflows_V3>` возвращают:

- информацию об общем (сводном) статусе по всем МЧД для всех сущностей документа внутри структуры :doc:`../proto/PowerOfAttorneyValidationStatus`, хранящейся в :doc:`../proto/DocflowStatusV3`,

- информацию о МЧД и ее статусе из подписи под документом внутри структуры :doc:`../proto/SignaturePowerOfAttorney`, хранящейся в :doc:`../proto/SignatureV3`.

Получение МЧД в документах
~~~~~~~~~~~~~~~~~~~~~~~~~~

Методы :doc:`../http/GetDocument`, :doc:`../http/GetDocuments`, :doc:`../http/GetDocumentsByMessageId` возвращают информацию об общем (сводном) статусе по всем МЧД для всех сущностей документа внутри структуры :doc:`../proto/PowerOfAttorneyValidationStatus`, хранящейся в :doc:`../proto/DocflowStatusV3`.


Как сгенерировать титут документа с МЧД
---------------------------------------

Для генерации :ref:`титула с МЧД <generate_title_xml_poa>` используйте метод :doc:`../http/GenerateTitleXml`.
 
 
Как подготовить к подписанию документ с МЧД
-------------------------------------------
 
Чтобы подготовить к подписанию документ с МЧД, используйте метод :doc:`../http/PrepareDocumentsToSign`. Для этого в структуре :doc:`../proto/utd/ExtendedSigner` заполните структуру :doc:`../proto/PowerOfAttorneyToPost`, указав в ней данные о МЧД.
