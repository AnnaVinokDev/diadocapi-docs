AuthenticateConfirm
===================

Метод ``AuthenticateConfirm`` предназначен для получения авторизационого токена при аутентификации по сертификату.

.. http:post:: /V2/AuthenticateConfirm

   :queryparam token: строка в формате Base64, полученная после расшифровки тела ответа метода :doc:`Authenticate <./Authenticate>`.
   :queryparam thumbprint: отпечаток сертификата пользователя. Необязательный параметр.
   :queryparam saveBinding: флаг для :ref:`сохранения привязки пользователя доверенного сервиса <save_binding>`. Укажите значение ``true``, если нужно сохранить привязку. Необязательный параметр. По умолчанию имеет значение ``false``.

   :requestheader Authorization: данные, необходимые для :doc:`авторизации <../Authorization>`. В заголовке нужно передать ``ddauth_api_client_id``.

   :request Body: Если параметр ``thumbprint`` не указан, тело запроса должно содержать :rfc:`X.509 <5280>` сертификат пользователя, сериализованный в `DER <http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf>`__. Иначе может быть пустым.

   :statuscode 200: операция успешно завершена.
   :statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры.
   :statuscode 401: в запросе отсутствует HTTP-заголовок ``Authorization``, или в этом заголовке отсутствует параметр ``ddauth_api_client_id``, или переданный в нем ключ разработчика не зарегистрирован в Диадоке.
   :statuscode 401: доступ запрещен.
   :statuscode 405: используется неподходящий HTTP-метод.
   :statuscode 500: при обработке запроса возникла непредвиденная ошибка.

   :response Body: Тело ответа содержит авторизационный токен.

Если в метод передаются одновременно отпечаток сертификата и сертификат, то отпечаток сертификата имеет более высокий приоритет. В этом случае сертификат из тела запроса игнорируется.

.. _save_binding:

Привязка пользователя доверенного сервиса
-----------------------------------------

Сохранить привязку пользователя доверенного сервиса с пользователем Диадока можно при аутентификации по сертификату или логину. Для этого в заголовке нужно указывать ключ ServiceKey, полученный доверенным сервисом, и идентификатор пользователя в доверенном сервисе (ServiceUserId).

Привязка производится автоматически при аутентификации по логину и паролю.

При аутентификации по сертификату автоматической привязки нет, нужно указать параметр ``saveBinding=true``.

----

.. rubric:: Смотри также

*Инструкции:*
   - :doc:`../Authorization`

*Метод для аутентификации:*
   - :doc:`Authenticate` — возвращает авторизационный токен.