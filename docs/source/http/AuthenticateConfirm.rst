AuthenticateConfirm
===================

Метод предназначен для получения авторизационого токена и сохранения привязки пользователя доверенного сервиса при аутентификации по сертификату.

.. http:post:: /V2/AuthenticateConfirm

   :queryparam token: полученная после расшифровки тела ответа метода :doc:`Authenticate v3 <./Authenticate>` строка в формате base64.
   :queryparam thumbprint: отпечаток сертификата пользователя. Если на сервер передается одновременно и отпечаток сертификата, и сертификат в теле запроса, то отпечаток сертификата имеет более высокий приоритет. В этом случае сертификат из тела запроса игнорируется. Необязательный параметр.
   :queryparam saveBinding: флаг для :ref:`сохранения привязки пользователя доверенного сервиса <save_binding>`. Укажите значение ``true``, если нужно сохранить привязку. По умолчанию имеет значение ``false``. Необязательный параметр.

   :requestheader Authorization: данные, необходимые для :doc:`авторизации <../Authorization>`.

   :request Body: Если параметра ``thumbprint`` нет, тело запроса должно содержать :rfc:`X.509 <5280>` сертификат пользователя, сериализованный в `DER <http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf>`__. Может быть пустым, если есть параметр ``thunmbprint``.

   :statuscode 200: операция успешно завершена.
	:statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры.
	:statuscode 401: в запросе отсутствует HTTP-заголовок ``Authorization``, или в этом заголовке отсутствует параметр ``ddauth_api_client_id``, или переданный в нем ключ разработчика не зарегистрирован в Диадоке.
   :statuscode 401: доступ запрещен.
	:statuscode 405: используется неподходящий HTTP-метод.
	:statuscode 500: при обработке запроса возникла непредвиденная ошибка.

   :response Body: Тело ответа содержит авторизационный токен.

.. _save_binding:

Привязка пользователя доверенного сервиса
-----------------------------------------

Сохранить привязку пользователя доверенного сервиса с пользователем Диадока можно при аутентификации по сертификату или логину. Для этого в заголовке нужно указывать ключ (ServiceKey), полученный доверенным сервисом, и идентификатор пользователя в доверенном сервисе (ServiceUserId).

Привязка производится автоматически при аутентификации по логину и паролю.

При аутентификации по сертификату укажите параметр ``saveBinding=true`` в запросе :doc:`AuthenticateConfirm`.


