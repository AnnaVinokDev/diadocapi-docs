ShelfUpload
===========

Метод ``ShelfUpload`` загружает фрагмент документа на «полку документов».

.. http:post:: /ShelfUpload

	:queryparam nameOnShelf: имя документа на «полке документов».
	:queryparam partIndex: номер загружаемого фрагмента документа. Фрагменты индексируются с 0.
	:queryparam isLastPart: признак того, что загружается последний фрагмент документа. Для последнего фрагмента должен быть равен 1, для остальных — может отсутствовать или быть равным 0.

	:requestheader Authorization: данные, необходимые для :doc:`авторизации <../Authorization>`.

	:statuscode 200: операция успешно завершена.
	:statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры.
	:statuscode 403: доступ к ящику с предоставленным авторизационным токеном запрещен.
	:statuscode 500: при обработке запроса возникла непредвиденная ошибка.

Для выполнения метода текущий пользователь должен быть авторизован в Диадоке, иначе метод вернет ошибку ``403 (Forbidden)``.

Загруженный документ хранится на «полке» 30 дней.

Загрузка документа
~~~~~~~~~~~~~~~~~~

Чтобы загрузить документ на «полку», разделите его бинарное содержимое на части и загрузите каждую часть отдельным вызовом метода ``ShelfUpload``. Последнюю часть документа загрузите с параметром ``isLastPart = 1``: это сообщит серверу, что вы загрузили все части документа. В ответе метод сообщит, все ли части были загружены успешно.

Если при загрузке каких-то частей документа произошли ошибки, то метод вернет в теле ответа список номеров этих частей в формате JSON: загрузите эти части повторно. 

Если документ загружен полностью, то он становится доступным для чтения с «полки документов», и его имя можно указать в поле ``NameOfShelf`` структур :doc:`../proto/SignedContent` и :doc:`../proto/UnsignedContent`.

.. note::
	Нельзя загрузить на «полку» документ размером больше 400 Мб.

Пространства имен на «полке документов»
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Пространство имен документов на «полке» делится на локальное для пользователя и публичное.

По умолчанию при загрузке на «полку» имя документа будет публичным. То есть если вызвать метод ``ShelfUpload`` с параметром ``nameOnShelf = xyz``, то имя загруженного документа будет публичным: ``public/xyz``.

Чтобы загрузить такой документ с локальным именем, при вызове метода ``ShelfUpload`` нужно указать в качестве параметра ``nameOfShelf`` значение ``_userId_/xyz``,  где ``_userId_`` — это строковый литерал. Тогда документ будет загружен на полку с именем ``user_private_files/{userId}/xyz``, значение ``{userId}`` будет взято из текущего авторизационного токена. Доступ к таким файлам можно получить с помощью метода ``ShelfDownload``, указав параметр ``nameOnShelf = __userId__/xyz``.

Методы :doc:`PostMessage` и :doc:`PostMessagePatch` трактуют переданное имя документа как локальное для пользователя, поэтому дописывают в начало имени префикс ``user_private_files/{userId}``.

----

.. rubric:: Смотри также

*Другие методы для работы с «полкой документов»:*
	- :doc:`ShelfDownload` — загружает файл с «полки».